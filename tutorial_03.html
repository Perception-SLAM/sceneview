<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Sceneview: Tutorial 03 - Custom renderer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Sceneview
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Tutorial 03 - Custom renderer </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial introduces the following:</p>
<ul>
<li>The scene graph</li>
<li>Creating a custom renderer</li>
<li>The resource manager</li>
<li>Geometry resources</li>
<li>Material resources</li>
</ul>
<h1>Tutorial code</h1>
<p>There are three files in this tutorial</p>
<p><code>my_renderer.hpp</code> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef SCENEVIEW_TUTORIAL_MY_RENDERER_HPP__</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define SCENEVIEW_TUTORIAL_MY_RENDERER_HPP__</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#include &lt;sceneview/sceneview.hpp&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>MyRenderer : <span class="keyword">public</span> <a class="code" href="classsv_1_1Renderer.html">sv::Renderer</a> {</div>
<div class="line">  Q_OBJECT</div>
<div class="line"></div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    MyRenderer(<span class="keyword">const</span> QString&amp; name, QWidget* parent = <span class="keyword">nullptr</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="classsv_1_1Renderer.html#ac16095c68cab21e15ef2e1c85029d416">InitializeGL</a>() <span class="keyword">override</span>;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#endif  // SCENEVIEW_TUTORIAL_MY_RENDERER_HPP__</span></div>
</div><!-- fragment --><p><code>my_renderer.cpp</code> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;my_renderer.hpp&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;sceneview/sceneview.hpp&gt;</span></div>
<div class="line"></div>
<div class="line">MyRenderer::MyRenderer(<span class="keyword">const</span> QString &amp;name, QWidget *parent)</div>
<div class="line">    : sv::Renderer(name, parent) {</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// This method is called once by sv::Viewport when the OpenGL subsystem is</span></div>
<div class="line"><span class="comment">// initialized. Override it to allocate graphics resources required by this</span></div>
<div class="line"><span class="comment">// renderer.</span></div>
<div class="line"><span class="keywordtype">void</span> MyRenderer::InitializeGL() {</div>
<div class="line">  sv::Scene::Ptr scene = GetScene();</div>
<div class="line">  sv::ResourceManager::Ptr resources = GetResources();</div>
<div class="line">  <a class="code" href="classsv_1_1GroupNode.html">sv::GroupNode</a>* base_node = GetBaseNode();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Create a geometry resource from a stock cube.</span></div>
<div class="line">  <a class="code" href="classsv_1_1StockResources.html">sv::StockResources</a> stock(resources);</div>
<div class="line">  sv::GeometryResource::Ptr cube = stock.Cube();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Create a material that will be used to control the cube&#39;s appearance.</span></div>
<div class="line">  sv::MaterialResource::Ptr material =</div>
<div class="line">      stock.NewMaterial(<a class="code" href="classsv_1_1StockResources.html#a3b093446053b2408050bdda92bc8f3ada8487127dc9ab79d85172c58b67546558">sv::StockResources::kUniformColorLighting</a>);</div>
<div class="line">  material-&gt;SetParam(<a class="code" href="group__sv__resources.html#gac54bd83ba381303f8c3532b1896cf0a2">sv::kDiffuse</a>, 1.0, 0.5, 0.5, 1.0);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Create a draw node from the geometry and material.</span></div>
<div class="line">  scene-&gt;MakeDrawNode(base_node, cube, material);</div>
<div class="line">}</div>
</div><!-- fragment --><p><code>tutorial_03_renderer.cpp</code> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;QApplication&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;sceneview/sceneview.hpp&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;my_renderer.hpp&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)</div>
<div class="line">{</div>
<div class="line">  QApplication app(argc, argv);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Create a sv::Viewer. This is a convenience widget that extends QMainWindow</span></div>
<div class="line">  <span class="comment">// and creates a &quot;stock&quot; application with the following contained widgets:</span></div>
<div class="line">  <span class="comment">// - sv::Viewport</span></div>
<div class="line">  <span class="comment">// - sv::RendererWidgetStack</span></div>
<div class="line">  <span class="comment">// - sv::InputHandlerWidgetStack</span></div>
<div class="line">  <a class="code" href="classsv_1_1Viewer.html">sv::Viewer</a> viewer;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Get the viewer&#39;s viewport widget.</span></div>
<div class="line">  <a class="code" href="classsv_1_1Viewport.html">sv::Viewport</a>* viewport = viewer.GetViewport();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Add a builtin grid renderer to the viewer&#39;s viewport.</span></div>
<div class="line">  <a class="code" href="classsv_1_1Renderer.html">sv::Renderer</a>* grid_renderer = <span class="keyword">new</span> <a class="code" href="classsv_1_1GridRenderer.html">sv::GridRenderer</a>(<span class="stringliteral">&quot;grid&quot;</span>, viewport);</div>
<div class="line">  viewport-&gt;AddRenderer(grid_renderer);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Add a custom renderer</span></div>
<div class="line">  <a class="code" href="classsv_1_1Renderer.html">sv::Renderer</a>* my_renderer = <span class="keyword">new</span> MyRenderer(<span class="stringliteral">&quot;my_renderer&quot;</span>, viewport);</div>
<div class="line">  viewport-&gt;AddRenderer(my_renderer);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Add a builtin input handler that controls the camera position and</span></div>
<div class="line">  <span class="comment">// orientation using mouse and keyboard input events.</span></div>
<div class="line">  <a class="code" href="classsv_1_1InputHandler.html">sv::InputHandler</a>* input_handler = <span class="keyword">new</span> <a class="code" href="classsv_1_1ViewHandlerHorizontal.html">sv::ViewHandlerHorizontal</a>(viewport,</div>
<div class="line">      QVector3D(0, 0, -1), viewport);</div>
<div class="line">  viewport-&gt;AddInputHandler(input_handler);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Show the viewer.</span></div>
<div class="line">  viewer.show();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Run the Qt event loop.</span></div>
<div class="line">  <span class="keywordflow">return</span> app.exec();</div>
<div class="line">}</div>
</div><!-- fragment --><h1>Running the code</h1>
<p>If you build and run this example, you'll hopefully see something like:</p>
<div class="image">
<img src="tutorial_03.png" alt="tutorial_03.png"/>
<div class="caption">
tutorial_03_renderer</div></div>
<p> Try interacting with the 3D rendering widget by cilcking and dragging with the mouse. You should be able to move the camera around, panning, zooming, rotating.</p>
<h1>Scene graph</h1>
<p>There are two ways to draw things in Sceneview:</p>
<ol type="1">
<li>Use the Sceneview rendering engine.</li>
<li>Call into OpenGL directly with your own OpenGL drawing commands.</li>
</ol>
<p>The <a class="el" href="design_overview.html">Design Overview</a> document has more information, but the basic idea is that if you're an OpenGL expert, then you can use Sceneview as a toolkit that provides some handy GUI elements and design patterns, and then go to town writing your own shaders and calling OpenGL directly. If you want to operate at a higher level of abstraction than what OpenGL provides, then Sceneview provides a way to do that using its scene graph and resource system.</p>
<p>There are many good online tutorials describing a scene graph, so we won't cover it here. The important thing to know about Sceneview is that there are exactly <a class="el" href="design_overview.html#design_scene_graph">4 node types</a> allowed in a Sceneview scene graph:</p>
<ul>
<li>Camera node</li>
<li>Group node</li>
<li>Light node</li>
<li>Draw node</li>
</ul>
<h1>Walking through the code</h1>
<h2>my_renderer.hpp</h2>
<p>Creating a custom renderer involves subclassing from <a class="el" href="classsv_1_1Renderer.html" title="Subclass this to add content in the scene and draw things. ">sv::Renderer</a>. <a class="el" href="classsv_1_1Renderer.html" title="Subclass this to add content in the scene and draw things. ">sv::Renderer</a> is itself a QObject, so you'll want to adhere to standard Qt practices that apply when subclassing QObject (e.g., use the <code>Q_OBJECT</code> macro).</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MyRenderer : <span class="keyword">public</span> <a class="code" href="classsv_1_1Renderer.html">sv::Renderer</a> {</div>
<div class="line">  Q_OBJECT</div>
</div><!-- fragment --><p>Every renderer has a name, set during construction. This name is used by other Sceneview widgets to identify the renderer in GUI elements.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span>:</div>
<div class="line">  MyRenderer(<span class="keyword">const</span> QString&amp; name, QWidget* parent = <span class="keyword">nullptr</span>);</div>
</div><!-- fragment --><p>When a <a class="el" href="classsv_1_1Renderer.html" title="Subclass this to add content in the scene and draw things. ">sv::Renderer</a> is first constructed, the OpenGL context may not have been initialized yet. To account for this, each renderer should override <a class="el" href="classsv_1_1Renderer.html#ac16095c68cab21e15ef2e1c85029d416" title="Override to acquire OpenGL resources required by the Renderer. ">sv::Renderer::InitializeGL</a>, which is called by Sceneview at the time the OpenGL context actually does get initialized.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> InitializeGL() <span class="keyword">override</span>;</div>
</div><!-- fragment --><p>In addition to <a class="el" href="classsv_1_1Renderer.html#ac16095c68cab21e15ef2e1c85029d416" title="Override to acquire OpenGL resources required by the Renderer. ">sv::Renderer::InitializeGL</a>, the following additional methods can be overridden:</p>
<ul>
<li><a class="el" href="classsv_1_1Renderer.html#ad857c23d8c149f42695790a9cf63fe3e" title="Override this to release any OpenGL resources acquired by the renderer. ">sv::Renderer::ShutdownGL</a> is called by Sceneview when shutting down the OpenGL context.</li>
<li><a class="el" href="classsv_1_1Renderer.html#afe2ff18f68e1a4eae3cbbd5001dd4070" title="Called at the start of rendering, just before the scene is rendered. ">sv::Renderer::RenderBegin</a> is called at the start of every draw cycle. A common use case is to override this and update rendering resources (e.g., appearance or geometry) just before render time.</li>
<li><a class="el" href="classsv_1_1Renderer.html#a29a30b4b882f1cb0c499ecc6fe390adc" title="Called at the end of rendering, just after the scene has finished rendering. ">sv::Renderer::RenderEnd</a> is called at the end of every draw cycle.</li>
</ul>
<p>The <a class="el" href="classsv_1_1Renderer.html" title="Subclass this to add content in the scene and draw things. ">sv::Renderer</a> class API provides additional documentation and information on what other resources are available.</p>
<h2>my_renderer.cpp</h2>
<p>The meat of our custom renderer happens in its implementation of InitializeGL. Starting off we have:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> MyRenderer::InitializeGL() {</div>
<div class="line">  sv::Scene::Ptr scene = GetScene();</div>
<div class="line">  sv::ResourceManager::Ptr resources = GetResources();</div>
</div><!-- fragment --><p>To start off with, it calls <a class="el" href="classsv_1_1Renderer.html#ab0106ee54e70b6ec492538f68e723a1d" title="Retrieve the Scene graph used by the Sceneview rendering engine. ">sv::Renderer::GetScene()</a> to get a pointer to the scene graph. This is reasonable, as we want to add drawable things to the scene graph. Where does the scene graph come from?</p>
<ul>
<li>By default, each <a class="el" href="classsv_1_1Viewport.html" title="Widget that draws a scene and manages Renderer and InputHandler objects. ">sv::Viewport</a> creates its own scene graph.</li>
<li>Prior to being able to render anything, every <a class="el" href="classsv_1_1Renderer.html" title="Subclass this to add content in the scene and draw things. ">sv::Renderer</a> must be attached to a <a class="el" href="classsv_1_1Viewport.html" title="Widget that draws a scene and manages Renderer and InputHandler objects. ">sv::Viewport</a>.</li>
<li>When a <a class="el" href="classsv_1_1Renderer.html" title="Subclass this to add content in the scene and draw things. ">sv::Renderer</a> is attached to a <a class="el" href="classsv_1_1Viewport.html" title="Widget that draws a scene and manages Renderer and InputHandler objects. ">sv::Viewport</a> via sv::AddRenderer, the viewport updates the renderer with the viewport's scene graph.</li>
</ul>
<p>Similar to the scene graph, every <a class="el" href="classsv_1_1Viewport.html" title="Widget that draws a scene and manages Renderer and InputHandler objects. ">sv::Viewport</a> also has a resource manager, which gets passed to the <a class="el" href="classsv_1_1Renderer.html" title="Subclass this to add content in the scene and draw things. ">sv::Renderer</a>.</p>
<p>Next, we have:</p>
<div class="fragment"><div class="line"><a class="code" href="classsv_1_1GroupNode.html">sv::GroupNode</a>* base_node = GetBaseNode();</div>
</div><!-- fragment --><p>When a renderer is added to a viewport, the viewport automatically creates a <a class="el" href="classsv_1_1GroupNode.html" title="A scene graph node that can have children. ">sv::GroupNode</a> in the scene graph and assigns it to the renderer. This node can then be used by the renderer to attach nodes to the scene graph that are owned and managed by the renderer. In addition to providing a default way of grouping and organizing nodes in the scene graph, this also enables Sceneview to enable or disable entire renderers by disabling the renderer's base group node.</p>
<p>If you want, you could bypass the renderer's base node and attach nodes directly to the scene graph, but then you'll lose the ability to let Sceneview manage some rendering aspects for you.</p>
<p>Every item that can be drawn in the scene graph needs two parts: geometry and appearance. The geometry generally specifies the shape and location of what's being drawn. The appearance roughly dictates how the item will look (i.e., its color).</p>
<p>Our custom renderer inserts a simple red cube in the scene graph. To do this, it first creates the cube's geometry:</p>
<div class="fragment"><div class="line"><span class="comment">// Create a geometry resource from a stock cube.</span></div>
<div class="line"><a class="code" href="classsv_1_1StockResources.html">sv::StockResources</a> stock(resources);</div>
<div class="line">sv::GeometryResource::Ptr cube = stock.Cube();</div>
</div><!-- fragment --><p>Sceneview provides some stock geometry resources that you can use for simple rendering and also just to get started. You can define your own custom geometries and load your own meshes, but sometimes a simple cube is good enough.</p>
<p>Note that there is exactly one stock cube resource. If you create 10,000 cubes, the geometry will still only be stored once and what you'll have are 10,000 shared pointers to the same stock cube.</p>
<p>After creating the cube geometry, our custom renderer specifies its appearance. This is done using a <a class="el" href="classsv_1_1MaterialResource.html" title="Controls the appearance of a Drawable. ">sv::MaterialResource</a> :</p>
<div class="fragment"><div class="line"><span class="comment">// Create a material that will be used to control the cube&#39;s appearance.</span></div>
<div class="line">sv::MaterialResource::Ptr material =</div>
<div class="line">    stock.NewMaterial(<a class="code" href="classsv_1_1StockResources.html#a3b093446053b2408050bdda92bc8f3ada8487127dc9ab79d85172c58b67546558">sv::StockResources::kUniformColorLighting</a>);</div>
<div class="line">material-&gt;SetParam(<a class="code" href="group__sv__resources.html#gac54bd83ba381303f8c3532b1896cf0a2">sv::kDiffuse</a>, 1.0, 0.5, 0.5, 1.0);</div>
</div><!-- fragment --><p>Finally, the geometry and material are combined and attached to the scene graph in a new draw node.</p>
<div class="fragment"><div class="line">  <span class="comment">// Create a draw node from the geometry and material.</span></div>
<div class="line">  scene-&gt;MakeDrawNode(base_node, cube, material);</div>
<div class="line">}</div>
</div><!-- fragment --><h2>Adding the custom renderer to the viewport</h2>
<p>Now that we've defined a custom renderer, we can add it to the viewport. The following lines of code are the relevant bits in <code>tutorial_03_renderer.cpp</code>:</p>
<div class="fragment"><div class="line"><span class="comment">// Add a custom renderer</span></div>
<div class="line"><a class="code" href="classsv_1_1Renderer.html">sv::Renderer</a>* my_renderer = <span class="keyword">new</span> MyRenderer(<span class="stringliteral">&quot;my_renderer&quot;</span>, viewport);</div>
<div class="line">viewport-&gt;AddRenderer(my_renderer);</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Nov 17 2016 21:51:34 for Sceneview by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
